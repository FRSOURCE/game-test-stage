import{C as H,c as $,T as K,a as V,P as N,b as O,i as U,j as X,V as g,k as E,M as Y,l as q,m as I,A as j}from"./index-DacPFwv8.js";import{s as ee,a as te,b as ne}from"./setupShadows-BF5v_kTV.js";const re=({scene:e})=>{const n={width:200,height:200,subdivisions:500,minHeight:0,maxHeight:16,updatable:!1},t=H("texturedGround","textures/snow/heightMapLowRes.webp",n,e),{material:r}=$({scene:e},{name:"groundMaterial",dir:"/textures/snow",uScale:4,vScale:4}),i=new K(`${"/game-test-stage/".slice(0,-1)}/maps/Snow/groundOpacityMask.webp`,e);i.hasAlpha=!0,r.opacityTexture=i,r.emissiveColor=new V(.9,.9,.9),r.emissiveIntensity=.07,r.roughness=.95,r.subSurface.tintColor=new V(.9,.96,.96),r.subSurface.isRefractionEnabled=!0,r.subSurface.refractionIntensity=.2,r.subSurface.indexOfRefraction=2.1,t.material=r,t.receiveShadows=!0,t.renderingGroupId=0;const s=H("physicsGround","textures/snow/heightMapLowRes_physics.webp",{...n,subdivisions:100,onReady:()=>new N(s,O.MESH,{mass:0},e)},e);return s.isVisible=!1,t.checkCollisions=!1,t.isPickable=!1,s.checkCollisions=!0,s.isPickable=!1,t.freezeNormals(),s.freezeNormals(),t.freezeWorldMatrix(),s.freezeWorldMatrix(),{ground:t,physicsGround:s}};function ie(e,n,t=2){const r=n&&n.length,i=r?n[0]*t:e.length;let s=D(e,0,i,t,!0);const o=[];if(!s||s.next===s.prev)return o;let x,u,l;if(r&&(s=le(e,n,s,t)),e.length>80*t){x=1/0,u=1/0;let y=-1/0,a=-1/0;for(let w=t;w<i;w+=t){const v=e[w],p=e[w+1];v<x&&(x=v),p<u&&(u=p),v>y&&(y=v),p>a&&(a=p)}l=Math.max(y-x,a-u),l=l!==0?32767/l:0}return k(s,o,t,x,u,l,0),o}function D(e,n,t,r,i){let s;if(i===Fe(e,n,t,r)>0)for(let o=n;o<t;o+=r)s=A(o/r|0,e[o],e[o+1],s);else for(let o=t-r;o>=n;o-=r)s=A(o/r|0,e[o],e[o+1],s);return s&&L(s,s.next)&&(C(s),s=s.next),s}function m(e,n){if(!e)return e;n||(n=e);let t=e,r;do if(r=!1,!t.steiner&&(L(t,t.next)||h(t.prev,t,t.next)===0)){if(C(t),t=n=t.prev,t===t.next)break;r=!0}else t=t.next;while(r||t!==n);return n}function k(e,n,t,r,i,s,o){if(!e)return;!o&&s&&ye(e,r,i,s);let x=e;for(;e.prev!==e.next;){const u=e.prev,l=e.next;if(s?se(e,r,i,s):oe(e)){n.push(u.i,e.i,l.i),C(e),e=l.next,x=l.next;continue}if(e=l,e===x){o?o===1?(e=xe(m(e),n),k(e,n,t,r,i,s,2)):o===2&&ue(e,n,t,r,i,s):k(m(e),n,t,r,i,s,1);break}}}function oe(e){const n=e.prev,t=e,r=e.next;if(h(n,t,r)>=0)return!1;const i=n.x,s=t.x,o=r.x,x=n.y,u=t.y,l=r.y,y=i<s?i<o?i:o:s<o?s:o,a=x<u?x<l?x:l:u<l?u:l,w=i>s?i>o?i:o:s>o?s:o,v=x>u?x>l?x:l:u>l?u:l;let p=r.next;for(;p!==n;){if(p.x>=y&&p.x<=w&&p.y>=a&&p.y<=v&&Z(i,x,s,u,o,l,p.x,p.y)&&h(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function se(e,n,t,r){const i=e.prev,s=e,o=e.next;if(h(i,s,o)>=0)return!1;const x=i.x,u=s.x,l=o.x,y=i.y,a=s.y,w=o.y,v=x<u?x<l?x:l:u<l?u:l,p=y<a?y<w?y:w:a<w?a:w,d=x>u?x>l?x:l:u>l?u:l,F=y>a?y>w?y:w:a>w?a:w,P=J(v,p,n,t,r),M=J(d,F,n,t,r);let c=e.prevZ,f=e.nextZ;for(;c&&c.z>=P&&f&&f.z<=M;){if(c.x>=v&&c.x<=d&&c.y>=p&&c.y<=F&&c!==i&&c!==o&&Z(x,y,u,a,l,w,c.x,c.y)&&h(c.prev,c,c.next)>=0||(c=c.prevZ,f.x>=v&&f.x<=d&&f.y>=p&&f.y<=F&&f!==i&&f!==o&&Z(x,y,u,a,l,w,f.x,f.y)&&h(f.prev,f,f.next)>=0))return!1;f=f.nextZ}for(;c&&c.z>=P;){if(c.x>=v&&c.x<=d&&c.y>=p&&c.y<=F&&c!==i&&c!==o&&Z(x,y,u,a,l,w,c.x,c.y)&&h(c.prev,c,c.next)>=0)return!1;c=c.prevZ}for(;f&&f.z<=M;){if(f.x>=v&&f.x<=d&&f.y>=p&&f.y<=F&&f!==i&&f!==o&&Z(x,y,u,a,l,w,f.x,f.y)&&h(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function xe(e,n){let t=e;do{const r=t.prev,i=t.next.next;!L(r,i)&&W(r,t,t.next,i)&&S(r,i)&&S(i,r)&&(n.push(r.i,t.i,i.i),C(t),C(t.next),t=e=i),t=t.next}while(t!==e);return m(t)}function ue(e,n,t,r,i,s){let o=e;do{let x=o.next.next;for(;x!==o.prev;){if(o.i!==x.i&&ve(o,x)){let u=Q(o,x);o=m(o,o.next),u=m(u,u.next),k(o,n,t,r,i,s,0),k(u,n,t,r,i,s,0);return}x=x.next}o=o.next}while(o!==e)}function le(e,n,t,r){const i=[];for(let s=0,o=n.length;s<o;s++){const x=n[s]*r,u=s<o-1?n[s+1]*r:e.length,l=D(e,x,u,r,!1);l===l.next&&(l.steiner=!0),i.push(we(l))}i.sort(ce);for(let s=0;s<i.length;s++)t=fe(i[s],t);return t}function ce(e,n){return e.x-n.x}function fe(e,n){const t=ae(e,n);if(!t)return n;const r=Q(t,e);return m(r,r.next),m(t,t.next)}function ae(e,n){let t=n;const r=e.x,i=e.y;let s=-1/0,o;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const a=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(a<=r&&a>s&&(s=a,o=t.x<t.next.x?t:t.next,a===r))return o}t=t.next}while(t!==n);if(!o)return null;const x=o,u=o.x,l=o.y;let y=1/0;t=o;do{if(r>=t.x&&t.x>=u&&r!==t.x&&Z(i<l?r:s,i,u,l,i<l?s:r,i,t.x,t.y)){const a=Math.abs(i-t.y)/(r-t.x);S(t,e)&&(a<y||a===y&&(t.x>o.x||t.x===o.x&&pe(o,t)))&&(o=t,y=a)}t=t.next}while(t!==x);return o}function pe(e,n){return h(e.prev,e,n.prev)<0&&h(n.next,e,e.next)<0}function ye(e,n,t,r){let i=e;do i.z===0&&(i.z=J(i.x,i.y,n,t,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,he(i)}function he(e){let n,t=1;do{let r=e,i;e=null;let s=null;for(n=0;r;){n++;let o=r,x=0;for(let l=0;l<t&&(x++,o=o.nextZ,!!o);l++);let u=t;for(;x>0||u>0&&o;)x!==0&&(u===0||!o||r.z<=o.z)?(i=r,r=r.nextZ,x--):(i=o,o=o.nextZ,u--),s?s.nextZ=i:e=i,i.prevZ=s,s=i;r=o}s.nextZ=null,t*=2}while(n>1);return e}function J(e,n,t,r,i){return e=(e-t)*i|0,n=(n-r)*i|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e|n<<1}function we(e){let n=e,t=e;do(n.x<t.x||n.x===t.x&&n.y<t.y)&&(t=n),n=n.next;while(n!==e);return t}function Z(e,n,t,r,i,s,o,x){return(i-o)*(n-x)>=(e-o)*(s-x)&&(e-o)*(r-x)>=(t-o)*(n-x)&&(t-o)*(s-x)>=(i-o)*(r-x)}function ve(e,n){return e.next.i!==n.i&&e.prev.i!==n.i&&!de(e,n)&&(S(e,n)&&S(n,e)&&ge(e,n)&&(h(e.prev,e,n.prev)||h(e,n.prev,n))||L(e,n)&&h(e.prev,e,e.next)>0&&h(n.prev,n,n.next)>0)}function h(e,n,t){return(n.y-e.y)*(t.x-n.x)-(n.x-e.x)*(t.y-n.y)}function L(e,n){return e.x===n.x&&e.y===n.y}function W(e,n,t,r){const i=B(h(e,n,t)),s=B(h(e,n,r)),o=B(h(t,r,e)),x=B(h(t,r,n));return!!(i!==s&&o!==x||i===0&&T(e,t,n)||s===0&&T(e,r,n)||o===0&&T(t,e,r)||x===0&&T(t,n,r))}function T(e,n,t){return n.x<=Math.max(e.x,t.x)&&n.x>=Math.min(e.x,t.x)&&n.y<=Math.max(e.y,t.y)&&n.y>=Math.min(e.y,t.y)}function B(e){return e>0?1:e<0?-1:0}function de(e,n){let t=e;do{if(t.i!==e.i&&t.next.i!==e.i&&t.i!==n.i&&t.next.i!==n.i&&W(t,t.next,e,n))return!0;t=t.next}while(t!==e);return!1}function S(e,n){return h(e.prev,e,e.next)<0?h(e,n,e.next)>=0&&h(e,e.prev,n)>=0:h(e,n,e.prev)<0||h(e,e.next,n)<0}function ge(e,n){let t=e,r=!1;const i=(e.x+n.x)/2,s=(e.y+n.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next;while(t!==e);return r}function Q(e,n){const t=R(e.i,e.x,e.y),r=R(n.i,n.x,n.y),i=e.next,s=n.prev;return e.next=n,n.prev=e,t.next=i,i.prev=t,r.next=t,t.prev=r,s.next=r,r.prev=s,r}function A(e,n,t,r){const i=R(e,n,t);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function C(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function R(e,n,t){return{i:e,x:n,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Fe(e,n,t,r){let i=0;for(let s=n,o=t-r;s<t;s+=r)i+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return i}const me=(e,n,t,r)=>{const i=new I(e.x,e.y),s=new I(n.x,n.y),o=j.BetweenTwoPoints(s,i).radians(),x=I.Distance(i,s),u=E("skiJump",{width:t.width,height:x},r);return u.rotation.addInPlaceFromFloats(Math.PI/2-o,Math.PI/2,0),u.position=g.Lerp(e,n,.5),u},Pe=({first2Points:e,skiJumpBacksideHeight:n})=>{const t=Math.tan(j.BetweenTwoPoints(new I(e[1].x,e[1].y),new I(e[0].x,e[0].y)).radians()),r=n/t-e[0].y/t+e[0].x;return new g(r,n,0)},Me=({scene:e,frontHeight:n,backHeight:t,width:r,length:i,position:s})=>{const o=new g(i*.7,n+9,0),x=new g(i*.5,n-1.5,0),u=new g(0,n,0),y=U.CreateQuadraticBezier(o,x,u,64).getPoints(),a=Pe({first2Points:y.slice(0,2),skiJumpBacksideHeight:t}),v=[new g(i,t,0),a,...y],p=[];v.forEach((z,G,b)=>{if(b[G+1]){const _=me(z,b[G+1],{width:r},e);p.push(_)}});const d=X("skiJumpSide",{shape:[new g(0,0,0),new g(i,0,0),...v.map(z=>new g(z.x,0,z.y))]},e,ie);d.rotation.addInPlaceFromFloats(-Math.PI/2,0,0),d.position.addInPlaceFromFloats(0,0,-r/2);const F=d.clone("skiJumpSide2");F.scaling.addInPlaceFromFloats(0,-2,0),F.position.addInPlaceFromFloats(0,0,r);const P=E("skiJumpFront",{width:r,height:n},e);P.position.addInPlaceFromFloats(0,n/2,0),P.rotation.addInPlaceFromFloats(0,Math.PI/2,0);const M=E("skiJumpBack",{width:r,height:t},e);M.position.addInPlaceFromFloats(i,t/2,0),M.rotation.addInPlaceFromFloats(0,-Math.PI/2,0),p.push(d,F,P,M);const c=Y.MergeMeshes(p),f=new q("skiJumpMaterial",e);return c.material=f,c.receiveShadows=!0,f.roughness=.4,c.position.addInPlace(s),new N(c,O.MESH,{mass:0},e)},Se=({scene:e})=>{const n=re({scene:e});ee({scene:e}),te({scene:e}),Me({scene:e,position:new g(26.5,0,-2),frontHeight:15.2,backHeight:29,width:5,length:18});const t=ne({scene:e});return{ground:n,shadows:t}};export{Se as setup};
