import{a1 as Q,a2 as K,A as Z,a3 as E,a4 as U,w as W,Y as _,Z as $,I as M,a5 as R}from"./page-Dzx48J3X.js";import{s as X}from"./setupGroundSnow-eSEue_Xg.js";import{s as Y,a as b,b as q}from"./setupShadows-Cu3s2tFv.js";import"./default.vue_vue_type_script_setup_true_lang-DuMzsB0H.js";import"./app-4dd-GXxM.js";function ee(e,n,t=2){const o=n&&n.length,r=o?n[0]*t:e.length;let x=j(e,0,r,t,!0);const i=[];if(!x||x.next===x.prev)return i;let s,l,u;if(o&&(x=ie(e,n,x,t)),e.length>80*t){s=1/0,l=1/0;let p=-1/0,a=-1/0;for(let h=t;h<r;h+=t){const w=e[h],y=e[h+1];w<s&&(s=w),y<l&&(l=y),w>p&&(p=w),y>a&&(a=y)}u=Math.max(p-s,a-l),u=u!==0?32767/u:0}return k(x,i,t,s,l,u,0),i}function j(e,n,t,o,r){let x;if(r===he(e,n,t,o)>0)for(let i=n;i<t;i+=o)x=N(i/o|0,e[i],e[i+1],x);else for(let i=t-o;i>=n;i-=o)x=N(i/o|0,e[i],e[i+1],x);return x&&C(x,x.next)&&(B(x),x=x.next),x}function g(e,n){if(!e)return e;n||(n=e);let t=e,o;do if(o=!1,!t.steiner&&(C(t,t.next)||v(t.prev,t,t.next)===0)){if(B(t),t=n=t.prev,t===t.next)break;o=!0}else t=t.next;while(o||t!==n);return n}function k(e,n,t,o,r,x,i){if(!e)return;!i&&x&&ce(e,o,r,x);let s=e;for(;e.prev!==e.next;){const l=e.prev,u=e.next;if(x?ne(e,o,r,x):te(e)){n.push(l.i,e.i,u.i),B(e),e=u.next,s=u.next;continue}if(e=u,e===s){i?i===1?(e=re(g(e),n),k(e,n,t,o,r,x,2)):i===2&&oe(e,n,t,o,r,x):k(g(e),n,t,o,r,x,1);break}}}function te(e){const n=e.prev,t=e,o=e.next;if(v(n,t,o)>=0)return!1;const r=n.x,x=t.x,i=o.x,s=n.y,l=t.y,u=o.y,p=r<x?r<i?r:i:x<i?x:i,a=s<l?s<u?s:u:l<u?l:u,h=r>x?r>i?r:i:x>i?x:i,w=s>l?s>u?s:u:l>u?l:u;let y=o.next;for(;y!==n;){if(y.x>=p&&y.x<=h&&y.y>=a&&y.y<=w&&I(r,s,x,l,i,u,y.x,y.y)&&v(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function ne(e,n,t,o){const r=e.prev,x=e,i=e.next;if(v(r,x,i)>=0)return!1;const s=r.x,l=x.x,u=i.x,p=r.y,a=x.y,h=i.y,w=s<l?s<u?s:u:l<u?l:u,y=p<a?p<h?p:h:a<h?a:h,F=s>l?s>u?s:u:l>u?l:u,P=p>a?p>h?p:h:a>h?a:h,m=T(w,y,n,t,o),d=T(F,P,n,t,o);let c=e.prevZ,f=e.nextZ;for(;c&&c.z>=m&&f&&f.z<=d;){if(c.x>=w&&c.x<=F&&c.y>=y&&c.y<=P&&c!==r&&c!==i&&I(s,p,l,a,u,h,c.x,c.y)&&v(c.prev,c,c.next)>=0||(c=c.prevZ,f.x>=w&&f.x<=F&&f.y>=y&&f.y<=P&&f!==r&&f!==i&&I(s,p,l,a,u,h,f.x,f.y)&&v(f.prev,f,f.next)>=0))return!1;f=f.nextZ}for(;c&&c.z>=m;){if(c.x>=w&&c.x<=F&&c.y>=y&&c.y<=P&&c!==r&&c!==i&&I(s,p,l,a,u,h,c.x,c.y)&&v(c.prev,c,c.next)>=0)return!1;c=c.prevZ}for(;f&&f.z<=d;){if(f.x>=w&&f.x<=F&&f.y>=y&&f.y<=P&&f!==r&&f!==i&&I(s,p,l,a,u,h,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function re(e,n){let t=e;do{const o=t.prev,r=t.next.next;!C(o,r)&&G(o,t,t.next,r)&&S(o,r)&&S(r,o)&&(n.push(o.i,t.i,r.i),B(t),B(t.next),t=e=r),t=t.next}while(t!==e);return g(t)}function oe(e,n,t,o,r,x){let i=e;do{let s=i.next.next;for(;s!==i.prev;){if(i.i!==s.i&&ye(i,s)){let l=H(i,s);i=g(i,i.next),l=g(l,l.next),k(i,n,t,o,r,x,0),k(l,n,t,o,r,x,0);return}s=s.next}i=i.next}while(i!==e)}function ie(e,n,t,o){const r=[];for(let x=0,i=n.length;x<i;x++){const s=n[x]*o,l=x<i-1?n[x+1]*o:e.length,u=j(e,s,l,o,!1);u===u.next&&(u.steiner=!0),r.push(ae(u))}r.sort(xe);for(let x=0;x<r.length;x++)t=se(r[x],t);return t}function xe(e,n){return e.x-n.x}function se(e,n){const t=le(e,n);if(!t)return n;const o=H(t,e);return g(o,o.next),g(t,t.next)}function le(e,n){let t=n;const o=e.x,r=e.y;let x=-1/0,i;do{if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){const a=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(a<=o&&a>x&&(x=a,i=t.x<t.next.x?t:t.next,a===o))return i}t=t.next}while(t!==n);if(!i)return null;const s=i,l=i.x,u=i.y;let p=1/0;t=i;do{if(o>=t.x&&t.x>=l&&o!==t.x&&I(r<u?o:x,r,l,u,r<u?x:o,r,t.x,t.y)){const a=Math.abs(r-t.y)/(o-t.x);S(t,e)&&(a<p||a===p&&(t.x>i.x||t.x===i.x&&ue(i,t)))&&(i=t,p=a)}t=t.next}while(t!==s);return i}function ue(e,n){return v(e.prev,e,n.prev)<0&&v(n.next,e,e.next)<0}function ce(e,n,t,o){let r=e;do r.z===0&&(r.z=T(r.x,r.y,n,t,o)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,fe(r)}function fe(e){let n,t=1;do{let o=e,r;e=null;let x=null;for(n=0;o;){n++;let i=o,s=0;for(let u=0;u<t&&(s++,i=i.nextZ,!!i);u++);let l=t;for(;s>0||l>0&&i;)s!==0&&(l===0||!i||o.z<=i.z)?(r=o,o=o.nextZ,s--):(r=i,i=i.nextZ,l--),x?x.nextZ=r:e=r,r.prevZ=x,x=r;o=i}x.nextZ=null,t*=2}while(n>1);return e}function T(e,n,t,o,r){return e=(e-t)*r|0,n=(n-o)*r|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e|n<<1}function ae(e){let n=e,t=e;do(n.x<t.x||n.x===t.x&&n.y<t.y)&&(t=n),n=n.next;while(n!==e);return t}function I(e,n,t,o,r,x,i,s){return(r-i)*(n-s)>=(e-i)*(x-s)&&(e-i)*(o-s)>=(t-i)*(n-s)&&(t-i)*(x-s)>=(r-i)*(o-s)}function ye(e,n){return e.next.i!==n.i&&e.prev.i!==n.i&&!pe(e,n)&&(S(e,n)&&S(n,e)&&ve(e,n)&&(v(e.prev,e,n.prev)||v(e,n.prev,n))||C(e,n)&&v(e.prev,e,e.next)>0&&v(n.prev,n,n.next)>0)}function v(e,n,t){return(n.y-e.y)*(t.x-n.x)-(n.x-e.x)*(t.y-n.y)}function C(e,n){return e.x===n.x&&e.y===n.y}function G(e,n,t,o){const r=z(v(e,n,t)),x=z(v(e,n,o)),i=z(v(t,o,e)),s=z(v(t,o,n));return!!(r!==x&&i!==s||r===0&&L(e,t,n)||x===0&&L(e,o,n)||i===0&&L(t,e,o)||s===0&&L(t,n,o))}function L(e,n,t){return n.x<=Math.max(e.x,t.x)&&n.x>=Math.min(e.x,t.x)&&n.y<=Math.max(e.y,t.y)&&n.y>=Math.min(e.y,t.y)}function z(e){return e>0?1:e<0?-1:0}function pe(e,n){let t=e;do{if(t.i!==e.i&&t.next.i!==e.i&&t.i!==n.i&&t.next.i!==n.i&&G(t,t.next,e,n))return!0;t=t.next}while(t!==e);return!1}function S(e,n){return v(e.prev,e,e.next)<0?v(e,n,e.next)>=0&&v(e,e.prev,n)>=0:v(e,n,e.prev)<0||v(e,e.next,n)<0}function ve(e,n){let t=e,o=!1;const r=(e.x+n.x)/2,x=(e.y+n.y)/2;do t.y>x!=t.next.y>x&&t.next.y!==t.y&&r<(t.next.x-t.x)*(x-t.y)/(t.next.y-t.y)+t.x&&(o=!o),t=t.next;while(t!==e);return o}function H(e,n){const t=A(e.i,e.x,e.y),o=A(n.i,n.x,n.y),r=e.next,x=n.prev;return e.next=n,n.prev=e,t.next=r,r.prev=t,o.next=t,t.prev=o,x.next=o,o.prev=x,o}function N(e,n,t,o){const r=A(e,n,t);return o?(r.next=o.next,r.prev=o,o.next.prev=r,o.next=r):(r.prev=r,r.next=r),r}function B(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function A(e,n,t){return{i:e,x:n,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function he(e,n,t,o){let r=0;for(let x=n,i=t-o;x<t;x+=o)r+=(e[i]-e[x])*(e[x+1]+e[i+1]),i=x;return r}const we=(e,n,t,o)=>{const r=new M(e.x,e.y),x=new M(n.x,n.y),i=R.BetweenTwoPoints(x,r).radians(),s=M.Distance(r,x),l=E("skiJump",{width:t.width,height:s},o);return l.rotation.addInPlaceFromFloats(Math.PI/2-i,Math.PI/2,0),l.position=Z.Lerp(e,n,.5),l},Fe=({first2Points:e,skiJumpBacksideHeight:n})=>{const t=Math.tan(R.BetweenTwoPoints(new M(e[1].x,e[1].y),new M(e[0].x,e[0].y)).radians()),o=n/t-e[0].y/t+e[0].x;return new Z(o,n,0)},Ze=({scene:e,frontHeight:n,backHeight:t,width:o,length:r,position:x})=>{const i=new Z(r*.7,n+9,0),s=new Z(r*.5,n-1.5,0),l=new Z(0,n,0),p=Q.CreateQuadraticBezier(i,s,l,64).getPoints(),a=Fe({first2Points:p.slice(0,2),skiJumpBacksideHeight:t}),w=[new Z(r,t,0),a,...p],y=[];w.forEach((J,V,D)=>{if(D[V+1]){const O=we(J,D[V+1],{width:o},e);y.push(O)}});const F=K("skiJumpSide",{shape:[new Z(0,0,0),new Z(r,0,0),...w.map(J=>new Z(J.x,0,J.y))]},e,ee);F.rotation.addInPlaceFromFloats(-Math.PI/2,0,0),F.position.addInPlaceFromFloats(0,0,-o/2);const P=F.clone("skiJumpSide2");P.scaling.addInPlaceFromFloats(0,-2,0),P.position.addInPlaceFromFloats(0,0,o);const m=E("skiJumpFront",{width:o,height:n},e);m.position.addInPlaceFromFloats(0,n/2,0),m.rotation.addInPlaceFromFloats(0,Math.PI/2,0);const d=E("skiJumpBack",{width:o,height:t},e);d.position.addInPlaceFromFloats(r,t/2,0),d.rotation.addInPlaceFromFloats(0,-Math.PI/2,0),y.push(F,P,m,d);const c=U.MergeMeshes(y),f=new W("skiJumpMaterial",e);return c.material=f,c.receiveShadows=!0,f.roughness=.4,c.position.addInPlace(x),new _(c,$.MESH,{mass:0},e)},ke=({scene:e})=>{const n=X({scene:e}),t=Y({scene:e});b({scene:e}),Ze({scene:e,position:new Z(26.5,0,-2),frontHeight:15.2,backHeight:29,width:5,length:18});const o=q({scene:e});return{ground:n,shadows:o,env:t}};export{ke as setup};
